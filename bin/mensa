#!/usr/bin/python3
import argparse

from mensa import logic
from mensa import base

parser = argparse.ArgumentParser(description='Fetch menus from various sources')
parser.add_argument('rest', nargs="*",
                    metavar='RESTAURANT',
                    help='Fetch menus from this restaurant')
parser.add_argument('-l', '--list-restaurants',  dest='list', action='store_true',
                    help='get list of restaurants')
parser.add_argument('-f', '--formatter', dest='form', action='store', nargs=1, help="formatter to use")
parser.add_argument('-g', '--vegetarian',  dest='vegetarian', action='store_true',
                    help='show only vegetarian meals')
parser.add_argument('-G', '--vegan',  dest='vegan', action='store_true',
                    help='show only vegan meals')


args = parser.parse_args()
## Load backends
logic.init_foodsources()
## Load frontends (not yet implemented)
logic.init_renderers()
veggie = 0
form = ["plain-text"]
if args.form :
    form = args.form
    

if args.vegetarian :
    veggie = 1
if args.vegan :
    veggie = 2



if args.list :
    for k,i in base.foodsources.items():
        print(i.name, i.human_name)
    exit()
restlist = None
if args.rest :
    restlist = args.rest

foodl = logic.get_food(restlist)
logic.render(foodl, form, only_veggie=veggie)
